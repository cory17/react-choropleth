(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{235:function(e,t,n){e.exports=n(463)},246:function(e,t,n){},463:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"geojsons",function(){return xe}),n.d(a,"toporefs",function(){return Ie}),n.d(a,"intensityMaps",function(){return Le});n(236);var o=n(228),r=n(1),i=n.n(r),c=n(10),s=n.n(c),u=n(80),p=n(222),l=n.n(p),d=(n(246),n(247),n(227)),f=n(29),h=n(30),m=n(34),v=n(32),j=n(35),y=(n(93),n(47)),b=n(60),g=(n(167),n(48)),O=(n(465),n(225)),E=(n(466),n(224)),k=(n(257),n(11)),w=(n(259),n(84)),C=n(51),S=n(24),x=n(223),I=["#FFEDA0","#FED976","#FEB24C","#FD8D3C","#FC4E2A","#E31A1C","#BD0026","#800026"],L=function(e){var t=e.features,n=Object(b.a)(e,["features"]),a=t.map(function(e,t){var n=e.properties,a=Object(b.a)(e,["properties"]),o=n,r=o.intensity,i="number"===typeof r&&r<=7;return Object(S.a)({},a,{properties:Object(S.a)({index:t},o,{intensity:i?r:0})})}),o=a.reduce(function(e,t){var n=t.properties;return Object(S.a)({},e,Object(C.a)({},n.index,n.intensity))},{});return{geo:Object(S.a)({},n,{features:a}),intensities:o}};function D(e){var t=Object.keys(e.objects)[0];return Object(x.a)(e,e.objects[t])}function U(e,t,n){!function(e,t){var n=JSON.stringify(e),a=new Blob([n],{type:"text/json"}),o=new MouseEvent("click",{}),r=document.createElement("a");r.download=t,r.href=window.URL.createObjectURL(a),r.dataset.downloadurl=["text/json",r.download,r.href].join(":"),r.dispatchEvent(o)}(Object(S.a)({},e,{features:e.features.map(function(e){var n=e.properties,a=Object(b.a)(e,["properties"]);return Object(S.a)({},a,{properties:Object(S.a)({},n,{intensity:t[n.index]})})})}),n)}var M=0;function T(){return++M}var F=n(82),N=n.n(F),A=w.a.Item;var R=function(e){var t=e.toporefs,n=e.onSelect;return i.a.createElement(w.a,{onSelect:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=e.key;return n(t)})},t.map(function(e){return i.a.createElement(A,{key:e.name},e.name)}))},G=function(e){var t=e.onSuccess;setTimeout(function(){t("ok")},0)},B=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).handleChange=function(e){switch(e.file.status){case"done":var t=new FileReader;t.onload=function(e){var t=e.target.result;n.handleDrop(t)},t.onerror=n.handleError,t.readAsText(e.file.originFileObj)}},n.handleError=function(){n.props.onUploadError("filesystem")},n.handleDrop=function(e){var t=function(e){var t={type:"unknown"};try{var n=JSON.parse(e);return n&&"object"===typeof n&&"string"===typeof n.type?n:t}catch(a){return t}}(e);switch(t.type){case"Topology":var a=t.type,o=t.objects,r=t.arcs,i=t.transform;if(o&&"object"===typeof o&&Object.keys(o).length&&r){Object.keys(o);var c=i?{type:a,arcs:r,objects:o,transform:i}:{type:a,arcs:r,objects:o};try{var s=D(c);n.props.onUpload(s)}catch(u){n.props.onUploadError("topojson")}}else n.props.onUploadError("topojson");break;case"FeatureCollection":try{N.a.geoJSON(t),n.props.onUpload(t)}catch(p){n.props.onUploadError("geojson")}break;default:n.props.onUploadError("parse")}},n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.toporefs,t=void 0===e?[]:e;return i.a.createElement(O.a,{title:"Choose a Geography"},i.a.createElement(E.a,{accept:"application/json",onChange:this.handleChange,showUploadList:!1,customRequest:G},i.a.createElement(y.a,null,i.a.createElement(k.a,{type:"upload"}),i.a.createElement("span",null,"Upload a Saved Choropleth, GeoJSON, or TopoJSON file"))),i.a.createElement(R,{toporefs:t,onSelect:this.props.onTopoSelect}))}}]),t}(i.a.Component),Z=(n(398),n(230)),z=(n(400),n(226)),J=(n(464),n(165)),q=(n(168),n(91).a.TabPane,J.a.Column),P=function(e){var t=e.items,n=void 0===t?[]:t;return i.a.createElement("ul",null,n.map(function(e){var t=e.key,n=e.value;return i.a.createElement("li",{key:t},"".concat(t,": ").concat(n))}))},H=function(e,t){return i.a.createElement(P,{items:t.props})},V=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={value:n.props.intensity},n.handleChange=function(e){n.setState({value:e})},n.handleAfterChange=function(e){n.props.onChange(n.props.index,e)},n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.state.value,t=this.props;t.index,t.onChange;return i.a.createElement("div",null,i.a.createElement(z.a,{value:e,min:0,max:7,onChange:this.handleChange,onAfterChange:this.handleAfterChange}),i.a.createElement(Z.a,{color:I[e]},e))}}]),t}(i.a.Component),K=function(e){var t=e.loading,n=e.regions,a=e.onRowClick,o=e.onIntensityChange;return i.a.createElement(J.a,{dataSource:n,loading:t,rowKey:"index",onRow:function(e){return{onClick:function(){return a(e)}}}},i.a.createElement(q,{title:"Index",dataIndex:"index"}),i.a.createElement(q,{title:"Intensity",dataIndex:"intensity",key:"intensity",render:function(e,t,n){var a=t.index;return i.a.createElement(V,{index:a,intensity:e,onChange:o})}}),i.a.createElement(q,{title:"Properties",key:"properties",render:H}))},W=(n(457),function(){function e(){Object(f.a)(this,e),this.map=void 0,this.geoLayer=void 0,this.featureLayers={}}return Object(h.a)(e,[{key:"loadMap",value:function(e,t){var n=t.url,a=t.attribution,o=t.center,r=void 0===o?[39.8282,-98.5795]:o,i=t.zoom,c=void 0===i?5:i,s=t.maxZoom,u=void 0===s?19:s;this.map=N.a.map(e,{center:r,zoom:c}),N.a.tileLayer(n,{maxZoom:u,attribution:a}).addTo(this.map),this.refresh()}},{key:"addGeojson",value:function(e,t){var n=this;this.featureLayers={},this.geoLayer=N.a.geoJSON(e,{onEachFeature:function(e,a){var o=e.properties,r=o.index,i=o.intensity,c={fillColor:I[i],weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.7};a.setStyle(c),a.on({click:function(e){t(e.latlng,r)}}),n.featureLayers[r]=a}}),this.geoLayer.addTo(this.map)}},{key:"updateFeature",value:function(e,t){this.featureLayers[e].setStyle({fillColor:I[t]})}},{key:"fitGeoLayer",value:function(){this.map.fitBounds(this.geoLayer.getBounds())}},{key:"refresh",value:function(){this.map.invalidateSize()}},{key:"zoomToFeature",value:function(e){var t=this.featureLayers[e];this.map.fitBounds(t.getBounds())}},{key:"removeGeojson",value:function(){this.map.removeLayer(this.geoLayer),this.featureLayers={}}}]),e}()),Q=i.a.createContext(null),X=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).node=void 0,n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.onLoad(this.node)}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"app-map",ref:function(t){e.node=t}})}}]),t}(i.a.Component),Y=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={map:new W,isLoaded:!1},n.handleMapLoad=function(e){n.state.map.loadMap(e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),n.setState({isLoaded:!0}),n.props.onLoad(n.state.map)},n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.state.isLoaded;return i.a.createElement(Q.Provider,{value:this.state.map},i.a.createElement("div",{className:"map-container"},i.a.createElement(X,{onLoad:this.handleMapLoad}),e?this.props.children:null))}}]),t}(i.a.Component),$=function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this.context,t=this.props,n=t.geojson,a=t.onClick;e.addGeojson(n,a),e.refresh(),e.fitGeoLayer()}},{key:"componentDidUpdate",value:function(e){var t=this.context,n=this.props,a=n.geojson,o=n.onClick;this.props.geojson!==e.geojson&&(t.removeGeojson(),t.addGeojson(a,o),t.fitGeoLayer(),t.refresh())}},{key:"componentWillUnmount",value:function(){this.context.removeGeojson()}},{key:"remove",value:function(){this.context.removeGeojson()}},{key:"render",value:function(){return this.props.children?this.props.children:null}}]),t}(i.a.Component);$.contextType=Q,$.defaultProps={onClick:function(){}};var _=function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(j.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this.context,t=this.props.index;e.zoomToFeature(t),this.props.onZoomEnd()}},{key:"render",value:function(){return null}}]),t}(i.a.PureComponent);_.contextType=Q;var ee=n(163);function te(e,t){return e.geojsons[t.geoID]}function ne(e,t){return e.intensityMaps[t.geoID]}var ae=Object(ee.a)(te,ne,function(e,t){return e?e.features.map(function(e){var n=e.properties;return function(e,t){var n=e.index,a=(e.intensity,Object(b.a)(e,["index","intensity"]));return{index:n,intensity:t,props:Object.keys(a).map(function(t){return{key:t,value:e[t]}})}}(n,t[n.index])}):void 0}),oe=Object(ee.b)({loading:function(e,t){return!e.geojsons[t.geoID]},geojson:te,intensities:ne,regions:ae}),re=function(e,t){return{type:"insert choropleth",data:Object(S.a)({id:e},L(t))}},ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"http error",data:Object(S.a)({type:e},t)}},ce=g.a.Header,se=g.a.Content,ue=g.a.Sider,pe=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={needsZoom:!1,zoomIndex:0},n.handleRowClick=function(e){var t=e.index;return n.setState(Object(S.a)({},n.state,{needsZoom:!0,zoomIndex:t}))},n.handleIntensityChange=function(e,t){var a=n.props.geoID,o=e;n.props.onIntensityChange(a,o,t),n.state.map.updateFeature(e,t)},n.handleZoomEnd=function(){return n.setState({needsZoom:!1})},n.handleMapLoad=function(e){n.setState(Object(S.a)({},n.state,{map:e}))},n.handleSave=function(){var e=n.props;U(e.geojson,e.intensities,"choropleth.json")},n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.geojson,n=e.regions,a=e.loading,o=this.state,r=o.needsZoom,c=o.zoomIndex;return i.a.createElement(g.a,{className:"app-content"},i.a.createElement(ue,{className:"app-sider",theme:"light",width:400},i.a.createElement(K,{loading:a,regions:n,onRowClick:this.handleRowClick,onIntensityChange:this.handleIntensityChange})),i.a.createElement(se,null,i.a.createElement(g.a,{className:"app-content"},i.a.createElement(ce,{style:{background:"#f2f2f2"}},i.a.createElement(y.a,{icon:"save",disabled:a,onClick:this.handleSave},"Save")),i.a.createElement(se,null,i.a.createElement(Y,{onLoad:this.handleMapLoad},t&&i.a.createElement($,{geojson:t},r&&i.a.createElement(_,{index:c,onZoomEnd:this.handleZoomEnd})))))))}}]),t}(i.a.Component),le=Object(u.b)(oe,{onIntensityChange:function(e,t,n){return{type:"update intensity",data:{geoID:e,featureID:t,newValue:n}}}})(pe),de=g.a.Header,fe=g.a.Content,he=function(e){var t=e.isBrowsing,n=e.geoID,a=e.toporefs,o=Object(b.a)(e,["isBrowsing","geoID","toporefs"]);return i.a.createElement(g.a,{className:"app"},i.a.createElement(de,null,i.a.createElement(y.a,{ghost:!0,onClick:o.onNewMapClick},"New Map")),i.a.createElement(fe,null,t?i.a.createElement(B,{toporefs:a,onTopoSelect:o.onTopoSelect,onUpload:o.onUpload,onUploadError:o.onUploadError}):i.a.createElement(le,{geoID:n})))},me=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(o)))).state={appStatus:"browsing"},n.handleTopoSelect=function(e){var t=n.props.toporefs.find(function(t){return t.name==e}).key;n.setState({appStatus:"mapping",geoID:T()},function(){n.props.requestTopojson(e,t,n.state.geoID)})},n.handleUpload=function(e){n.setState({appStatus:"mapping",geoID:T()},function(){var t=n.state.geoID;n.props.onUpload(t,e)})},n.handleFileError=function(){d.a.error("ERROR: Could not load file")},n.handleNewMapClick=function(){n.setState({appStatus:"browsing"})},n}return Object(j.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.browseMaps()}},{key:"render",value:function(){var e=this.state.geoID,t=this.props,n=t.toporefs,a=(t.requestTopojson,"browsing"==this.state.appStatus);return i.a.createElement(he,{isBrowsing:a,geoID:e,toporefs:n,onUploadError:this.handleFileError,onUpload:this.handleUpload,onTopoSelect:this.handleTopoSelect,onNewMapClick:this.handleNewMapClick})}}]),t}(i.a.Component),ve=Object(u.b)(function(e){return{toporefs:e.toporefs}},{browseMaps:function(){return{type:"browse maps",data:{}}},requestTopojson:function(e,t,n){return{type:"request topojson",data:{id:n,name:e,key:t}}},onUpload:re})(me),je=(n(458),n(69)),ye=n(472),be=n(471),ge=n(473),Oe=n(468),Ee=n(469),ke=n(57),we=n(470),Ce=n(231),Se=n(229),xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"insert choropleth":var n=t.data,a=n.geo,o=n.id;return Object(S.a)({},e,Object(C.a)({},o,a));default:return e}},Ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"insert toporefs":return t.data.toporefs;default:return e}},Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"insert choropleth":var n=t.data,a=n.id,o=n.intensities;return Object(S.a)({},e,Object(C.a)({},a,o));case"update intensity":var r=t.data,i=r.geoID,c=r.featureID,s=r.newValue;return Object(S.a)({},e,Object(C.a)({},i,Object(S.a)({},e[i],Object(C.a)({},c,s))));default:return e}},De=Object(ye.a)(function(e,t,n){var a=n.getFile;return e.pipe(Object(Se.a)("request topojson"),Object(Oe.a)("data"),Object(Ee.a)(function(e){var t=e.id,n=(e.key,e.name);return a("topojson/".concat(n,".json")).pipe(Object(ke.a)(function(e){return re(t,D(e))}),Object(we.a)(function(){return Object(Ce.a)(ie("topojson",{id:t}))}))}))},function(e,t,n){var a=n.getFile;return e.pipe(Object(Se.a)("browse maps"),Object(Ee.a)(function(){return a("toporefs.json").pipe(Object(ke.a)(function(e){return function(e){return{type:"insert toporefs",data:{toporefs:e}}}(e.toporefs)}),Object(we.a)(function(){return Object(Ce.a)(ie("toporefs"))}))}))}),Ue=Object(be.a)({dependencies:{getFile:function(e){return ge.a.getJSON("https://raw.githubusercontent.com/cory17/react-choropleth/master/api/"+e)}}}),Me=Object(je.combineReducers)(a),Te=Object(je.createStore)(Me,{},Object(je.applyMiddleware)(Ue));Ue.run(De);var Fe=Te;s.a.render(i.a.createElement(o.a,{locale:l.a},i.a.createElement(u.a,{store:Fe},i.a.createElement(ve,null))),document.getElementById("root"))}},[[235,1,2]]]);
//# sourceMappingURL=main.fe2a2a67.chunk.js.map